# 性能测试

## 项目简介

这是抽奖系统的性能测试项目，使用Apache JMeter 5.6.3进行压力测试、稳定性测试和并发测试，用于评估系统在不同负载下的性能表现，发现系统瓶颈并提供优化建议。

## 测试统计

- **测试场景**: 4个（基准测试、压力测试、混合场景、稳定性测试）
- **总请求数**: 26,385个
- **平均成功率**: 99.985%
- **测试工具**: Apache JMeter 5.6.3
- **测试日期**: 2025年10月20日
- **测试环境**: 云服务器 (101.42.36.43:8888)

## 测试场景文件

```
性能测试/
├── baseline_test.jmx           # 基准测试 (20并发用户)
├── stress_test.jmx             # 压力测试 (50-150并发递增)
├── mixed_scenario_test.jmx     # 混合场景测试 (100并发完整流程)
├── stability_test.jmx          # 稳定性测试 (30并发长时间)
└── README.md                   # 本文件
```

## 测试场景说明

### 1. 基准测试 (baseline_test.jmx)
**目的**: 建立系统性能基准，测试系统在正常负载下的响应时间

- **并发用户数**: 20
- **持续时间**: 1分钟
- **测试请求**: 993个
- **成功率**: 100%
- **平均响应时间**: 310ms
- **吞吐量**: 16.5 req/s

**业务流程**:
1. 用户登录
2. 查看奖品列表
3. 参与抽奖
4. 查询中奖记录

### 2. 压力测试 (stress_test.jmx)
**目的**: 测试系统承受能力，找出系统性能拐点

- **并发用户数**: 50 → 100 → 150 (递增)
- **持续时间**: 3分钟
- **测试请求**: 4,073个
- **成功率**: 99.95%
- **平均响应时间**: 1,829ms
- **吞吐量**: 22.6 req/s

**测试发现**:
- ✅ 50并发时系统表现良好
- ⚠️ 100并发时响应时间开始上升
- ❌ 150并发时出现少量错误（0.05%）

### 3. 混合场景测试 (mixed_scenario_test.jmx) ⭐ 推荐
**目的**: 模拟真实用户行为，测试系统综合性能

- **并发用户数**: 100
- **持续时间**: 5分钟
- **测试请求**: 18,465个
- **成功率**: 99.99%
- **平均响应时间**: 324ms
- **吞吐量**: 61.6 req/s

**业务流程**:
1. 用户登录 (30%)
2. 浏览奖品列表 (40%)
3. 参与抽奖 (20%)
4. 查询中奖记录 (10%)

**特点**: 最接近真实场景，权重分配合理

### 4. 稳定性测试 (stability_test.jmx)
**目的**: 测试系统长时间运行的稳定性

- **并发用户数**: 30
- **持续时间**: 10分钟
- **测试请求**: 2,854个
- **成功率**: 100%
- **平均响应时间**: 628ms
- **吞吐量**: 4.7 req/s

**测试结论**: 系统在长时间运行下保持稳定

## 环境准备

### 1. 安装JMeter
下载地址: https://jmeter.apache.org/download_jmeter.cgi

```bash
# 解压后配置环境变量
export JMETER_HOME=/path/to/jmeter
export PATH=$PATH:$JMETER_HOME/bin
```

### 2. 验证安装
```bash
jmeter -version
```

### 3. 安装JMeter插件（可选）
- Plugins Manager
- Custom Thread Groups
- 3 Basic Graphs

## 运行测试

### 方式1: GUI模式（推荐用于调试）
```bash
# 打开JMeter GUI
jmeter

# 然后File → Open → 选择.jmx文件
```

### 方式2: 命令行模式（推荐用于正式测试）
```bash
# 基准测试
jmeter -n -t baseline_test.jmx -l baseline_results.jtl -e -o baseline_report

# 压力测试
jmeter -n -t stress_test.jmx -l stress_results.jtl -e -o stress_report

# 混合场景测试
jmeter -n -t mixed_scenario_test.jmx -l mixed_results.jtl -e -o mixed_report

# 稳定性测试
jmeter -n -t stability_test.jmx -l stability_test.jtl -e -o stability_report
```

参数说明:
- `-n`: 命令行模式
- `-t`: 测试文件路径
- `-l`: 结果文件路径
- `-e`: 测试完成后生成报告
- `-o`: 报告输出目录

## 测试配置

### 线程组配置
```
Number of Threads: 并发用户数
Ramp-up Period: 启动时间
Loop Count: 循环次数
Duration: 持续时间（秒）
```

### HTTP请求默认值
```
Server Name: 101.42.36.43
Port: 8888
Protocol: http
```

### 断言配置
- 响应码断言: 200
- 响应时间断言: < 3000ms
- JSON断言: 验证返回数据结构

## 查看测试报告

### 方式1: 命令行生成的HTML报告
```
{场景名称}_report/index.html
```

### 方式2: 在主项目中查看
```
../全部测试报告/baseline_report/index.html
../全部测试报告/stress_report/index.html
../全部测试报告/mixed_report/index.html
../全部测试报告/stability_report/index.html
```

## 核心测试数据

### 响应时间统计

| 测试场景 | 平均响应时间 | 90%分位 | 95%分位 | 99%分位 | 最大响应时间 |
|---------|------------|---------|---------|---------|------------|
| 基准测试 | 310ms | 450ms | 520ms | 680ms | 890ms |
| 压力测试 | 1,829ms | 3,200ms | 4,100ms | 5,800ms | 8,200ms |
| 混合场景 | 324ms | 480ms | 560ms | 720ms | 950ms |
| 稳定性测试 | 628ms | 980ms | 1,150ms | 1,450ms | 2,100ms |

### 吞吐量对比

| 测试场景 | 吞吐量 | 并发用户 | 持续时间 |
|---------|-------|---------|---------|
| 基准测试 | 16.5 req/s | 20 | 1分钟 |
| 压力测试 | 22.6 req/s | 50-150 | 3分钟 |
| 混合场景 | 61.6 req/s | 100 | 5分钟 |
| 稳定性测试 | 4.7 req/s | 30 | 10分钟 |

## 性能瓶颈分析

### 发现的问题
1. **数据库连接池瓶颈**: 高并发下出现连接等待
2. **响应时间随并发增加**: 超过100并发后明显上升
3. **内存使用增长**: 长时间运行后内存占用持续增加

### 优化建议
1. **增加数据库连接池大小**: 从默认20增加到50-100
2. **引入Redis缓存**: 缓存热点数据（奖品列表、活动信息）
3. **使用消息队列**: 异步处理抽奖请求
4. **优化SQL查询**: 添加索引，优化复杂查询
5. **启用CDN**: 静态资源使用CDN加速

## 性能测试最佳实践

1. ✅ 从小负载开始，逐步增加
2. ✅ 每个场景至少运行3次取平均值
3. ✅ 测试环境与生产环境保持一致
4. ✅ 监控服务器资源（CPU、内存、磁盘、网络）
5. ✅ 记录每次测试的配置和结果
6. ⚠️ 测试前备份数据库
7. ⚠️ 避免在生产环境直接测试

## 推荐配置

基于测试结果，推荐生产环境配置：

| 配置项 | 推荐值 | 说明 |
|-------|-------|-----|
| 最大并发用户 | 80-100 | 超过后性能明显下降 |
| 数据库连接池 | 50-100 | 根据并发量调整 |
| JVM堆内存 | 2GB-4GB | 避免频繁GC |
| Redis缓存 | 是 | 缓存热点数据 |
| 负载均衡 | 建议 | 多实例部署 |

## 联系方式

- **测试工程师**: JPF
- **测试日期**: 2025年10月20日
- **问题反馈**: 请在项目中提issue

---

**测试工具**: Apache JMeter 5.6.3
**测试服务器**: 云服务器 (101.42.36.43:8888)
**报告生成**: JMeter HTML Dashboard

